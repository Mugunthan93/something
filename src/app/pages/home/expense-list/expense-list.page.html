<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="back()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Expense List</ion-title>
  </ion-toolbar>

  <ion-row class="totalExpense">
    <ion-label class="title">{{ (currentTrip$ | async).trip_name }}</ion-label>
    <ion-label class="bold large"> {{ (currentTrip$ | async).startDate | date : 'd MMM' }} - {{ (currentTrip$ | async).endDate | date : 'd MMM' }} </ion-label>
    <ion-label>Total Expenses</ion-label>
    <ion-label class="total">{{ totalCost() | async | currency : 'INR' }}</ion-label>
    <ion-buttons>
      <ion-button class="select" (click)="changeState(true)" *ngIf="(enableExp$ | async) == false">
        <ion-label>Select</ion-label>
      </ion-button>
      <ion-button 
        (click)="sendExpense('send')" 
        *ngIf="((enableExp$ | async) == true) && (tripType$ | async) == 'mytrips'" 
        [disabled]="selectdisable$ | async">
        <ion-label>send</ion-label>
      </ion-button>

      <ion-button 
        (click)="sendExpense('approve')" 
        *ngIf="((enableExp$ | async) == true) && (tripType$ | async) == 'approvaltrips'" 
        [disabled]="selectdisable$ | async">
        <ion-label>Approve</ion-label>
      </ion-button>

      <ion-button 
        (click)="sendExpense('reject')" 
        *ngIf="((enableExp$ | async) == true) && (tripType$ | async) == 'approvaltrips'" 
        [disabled]="selectdisable$ | async">
        <ion-label>Reject</ion-label>
      </ion-button>

      <ion-button (click)="changeState(false)" *ngIf="(enableExp$ | async) == true">
        <ion-label>Cancel</ion-label>
      </ion-button>
      <ion-button class="add" (click)="addExpense()" *ngIf="(tripType$ | async) == 'mytrips'">
        <ion-label>Add</ion-label>
      </ion-button>
    </ion-buttons>
  </ion-row>
</ion-header>

<ion-content>

  <ion-virtual-scroll [items]="expensesList$ | async" approxItemHeight="-webkit-fill-available">
    <ion-card *virtualItem="let expense">
      <ion-card-header>
        <ion-label class="bold large">{{ expense.type | titlecase }}</ion-label>
        <ion-row>
          <ion-label class="bold large">{{ expense.total | currency : 'INR' }}</ion-label>
          <ion-button (click) ="deleteExpense(expense.value)" *ngIf="(tripType$ | async) == 'mytrips'">
            <ion-icon name="close-sharp"></ion-icon>
          </ion-button>
        </ion-row>
      </ion-card-header>

      <ion-card-content>
        <ion-list *ngFor="let exp of expense.value" lines="full">
          <ion-label class="exp-date">
            {{ exp.date | date : 'dd LLL EEEE' }}
          </ion-label>

          <ion-item *ngFor="let e of exp.value;let i = index">
            <ion-row>
              <ion-checkbox *ngIf="(enableExp$ | async)" class="default" id="i" [value]="e" [checked]="checked(e) | async"
              (ionChange)="selectExpense($event)"></ion-checkbox>
              <ion-label class="bold large">{{ (e.local_travel_value !== null ? e.local_travel_value : '') | titlecase }}</ion-label>
              <ion-badge color="primary">{{ status(e) }}</ion-badge>
            </ion-row>
            <ion-row slot="end" (click)="getExpense($event,e)">
              <ion-label class="bold large">{{ e.cost | currency : 'INR' }}</ion-label>
              <ion-icon name="ellipsis-vertical-outline" *ngIf="!(enableExp$ | async) && (e.paid_by == 'paid_self' && e.status == 'new') && ((tripType$ | async) == 'mytrips')"></ion-icon>
            </ion-row>
          </ion-item>

        </ion-list>
      </ion-card-content>
    </ion-card>
  </ion-virtual-scroll>

  <!-- <ion-virtual-scroll [items]="expenses$ | async" approxItemHeight="60px">
      <ion-item *virtualItem="let expense">
        <ion-checkbox class="default" slot="start"></ion-checkbox>
        <ion-row class="expense-col-1">
          <ion-label class="large bold">{{ expense.type | uppercase }}</ion-label>
          <ion-label class="large bold">{{ expense.start_city | titlecase }} - {{ expense.end_city | titlecase }}</ion-label>
        </ion-row>
        <ion-row class="expense-col-2">
          <ion-label class="large bold">Cost :{{ expense.cost | currency : 'INR' }}</ion-label>
          <ion-label class="large bold">Eligibility :{{ expense.eligible_amount | currency : 'INR' }}</ion-label>
        </ion-row>
        <ion-row class="expense-col-3">
          <ion-label class="large bold">Paid By {{paidBy(expense) | titlecase}}</ion-label>
          <ion-label class="large bold">{{ expense.status | uppercase }}</ion-label>
        </ion-row>
      </ion-item>
  </ion-virtual-scroll> -->

</ion-content>
